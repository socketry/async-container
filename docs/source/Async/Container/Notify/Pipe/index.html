<!DOCTYPE html>
<html>
	<head>
		
			<title>Async::Container::Notify::Pipe</title>
		
		<meta charset="UTF-8"/>
		<meta name="viewport" content="width=device-width, initial-scale=1"/>
		
		<link rel="icon" type="image/png" href="../../../../../_static/icon.png"/>
		<link rel="stylesheet" href="../../../../../_static/site.css" type="text/css" media="screen"/>
		
		<script src="../../../../../_components/jquery/jquery.min.js"></script>
		<script src="../../../../../_components/jquery-syntax/jquery.syntax.min.js"></script>
		
		<script type="text/javascript">
		//<![CDATA[
			jQuery(function($) {
				$.syntax();
			});
		//]]>
		</script>
	</head>

	<body class="">
		<nav> › <a class="link" href="../../../../../index.html">Project</a> › <a class="link" href="../../../../index.html">Source</a></nav>
		
		
	<h1><code class="language-ruby">Async::Container::Notify::Pipe</code></h1>
	
	<main>
		<p>Implements a process readiness protocol using an inherited pipe file descriptor.</p>
		
		
		<h2>Definitions</h2>
		
		<h3 id="Async::Container::Notify::Pipe::NOTIFY_PIPE"><code class="language-ruby">NOTIFY_PIPE = 'NOTIFY_PIPE'</code></h3><p>The environment variable key which contains the pipe file descriptor.</p>
<h3 id="Async::Container::Notify::Pipe.open!"><code class="language-ruby">def self.open!(environment = ENV)</code></h3><p>Open a notification client attached to the current <a href="index.html#Async%3A%3AContainer%3A%3ANotify%3A%3APipe%3A%3ANOTIFY_PIPE" title="NOTIFY_PIPE"><code class="language-ruby">NOTIFY_PIPE = 'NOTIFY_PIPE'</code></a> if possible.</p>
<details>
							<summary><h4>Implementation</h4></summary>
							<pre><code class="language-ruby">def self.open!(environment = ENV)
	if descriptor = environment.delete(NOTIFY_PIPE)
		self.new(::IO.for_fd(descriptor.to_i))
	end
rescue Errno::EBADF =&gt; error
	Async.logger.error(self) {error}
	
	return nil
end</code></pre>
						</details><h3 id="Async::Container::Notify::Pipe#initialize"><code class="language-ruby">def initialize(io)</code></h3><p>Initialize the notification client.</p>
<details open>
	<summary><h4>Signature</h4></summary>
	<dl><dt>
					<strong>parameter</strong>　<code class="syntax">io</code>　<code class="language-ruby">IO</code></dt><dd><p>An IO instance used for sending messages.</p>
</dd></dl>
</details>
<details>
							<summary><h4>Implementation</h4></summary>
							<pre><code class="language-ruby">def initialize(io)
	@io = io
end</code></pre>
						</details><h3 id="Async::Container::Notify::Pipe#before_spawn"><code class="language-ruby">def before_spawn(arguments, options)</code></h3><p>Inserts or duplicates the environment given an argument array.
Sets or clears it in a way that is suitable for <code class="language-ruby">::Process.spawn</code>.</p>
<details>
							<summary><h4>Implementation</h4></summary>
							<pre><code class="language-ruby">def before_spawn(arguments, options)
	environment = environment_for(arguments)
	
	# Use `notify_pipe` option if specified:
	if notify_pipe = options.delete(:notify_pipe)
		options[notify_pipe] = @io
		environment[NOTIFY_PIPE] = notify_pipe.to_s
	
	# Use stdout if it's not redirected:
	# This can cause issues if the user expects stdout to be connected to a terminal.
	# elsif !options.key?(:out)
	# 	options[:out] = @io
	# 	environment[NOTIFY_PIPE] = &quot;1&quot;
	
	# Use fileno 3 if it's available:
	elsif !options.key?(3)
		options[3] = @io
		environment[NOTIFY_PIPE] = &quot;3&quot;
	
	# Otherwise, give up!
	else
		raise ArgumentError, &quot;Please specify valid file descriptor for notify_pipe!&quot;
	end
end</code></pre>
						</details><h3 id="Async::Container::Notify::Pipe#send"><code class="language-ruby">def send(**message)</code></h3><p>Formats the message using JSON and sends it to the parent controller.
This is suitable for use with <a href="../../Channel/index.html" title="Channel"><code class="language-ruby">class Async::Container::Channel</code></a>.</p>
<details>
							<summary><h4>Implementation</h4></summary>
							<pre><code class="language-ruby">def send(**message)
	data = ::JSON.dump(message)
	
	@io.puts(data)
	@io.flush
end</code></pre>
						</details>	</main>

		
		<footer>Documentation generated by <a href="https://github.com/socketry/utopia-project">Utopia::Project</a>.</footer>
	</body>
</html>